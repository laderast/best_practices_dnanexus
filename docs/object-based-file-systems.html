<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Best Practices on the DNAnexus Platform - 1&nbsp; Object Based File Systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./project_management.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./object-based-file-systems.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Object Based File Systems</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Best Practices on the DNAnexus Platform</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./object-based-file-systems.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Object Based File Systems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project_management.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Project and File Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ukb-rap.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Work Effectively on the UK Biobank Research Analysis Platform (UKB RAP)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spark-on-dnanexus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spark on the DNAnexus Platform</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dx_extract_dataset_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><code>dx extract_dataset</code> in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hail-skills.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Hail Skills and Concepts</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hail-gwas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">GWAS using Hail</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#who-this-chapter-is-for" id="toc-who-this-chapter-is-for" class="nav-link active" data-scroll-target="#who-this-chapter-is-for"><span class="header-section-number">1.1</span> Who This Chapter is For</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">1.2</span> Learning Objectives</a></li>
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology"><span class="header-section-number">1.3</span> Terminology</a></li>
  <li><a href="#review-posix-filesystems" id="toc-review-posix-filesystems" class="nav-link" data-scroll-target="#review-posix-filesystems"><span class="header-section-number">1.4</span> Review: POSIX Filesystems</a></li>
  <li><a href="#object-based-filesystems-are-different" id="toc-object-based-filesystems-are-different" class="nav-link" data-scroll-target="#object-based-filesystems-are-different"><span class="header-section-number">1.5</span> Object Based Filesystems are different</a></li>
  <li><a href="#comparing-posix-and-object-based-file-systems" id="toc-comparing-posix-and-object-based-file-systems" class="nav-link" data-scroll-target="#comparing-posix-and-object-based-file-systems"><span class="header-section-number">1.6</span> Comparing POSIX and Object Based File Systems</a></li>
  <li><a href="#tracing-the-journey-of-a-file-object-onto-the-platform" id="toc-tracing-the-journey-of-a-file-object-onto-the-platform" class="nav-link" data-scroll-target="#tracing-the-journey-of-a-file-object-onto-the-platform"><span class="header-section-number">1.7</span> Tracing the journey of a file object onto the platform</a></li>
  <li><a href="#copying-files-from-one-project-to-another" id="toc-copying-files-from-one-project-to-another" class="nav-link" data-scroll-target="#copying-files-from-one-project-to-another"><span class="header-section-number">1.8</span> Copying Files from One Project to Another</a>
  <ul class="collapse">
  <li><a href="#advantages-of-object-based-filesystems" id="toc-advantages-of-object-based-filesystems" class="nav-link" data-scroll-target="#advantages-of-object-based-filesystems"><span class="header-section-number">1.8.1</span> Advantages of Object Based Filesystems</a></li>
  <li><a href="#disadvantages-of-object-based-filesystems" id="toc-disadvantages-of-object-based-filesystems" class="nav-link" data-scroll-target="#disadvantages-of-object-based-filesystems"><span class="header-section-number">1.8.2</span> Disadvantages of Object Based Filesystems</a></li>
  </ul></li>
  <li><a href="#best-practice-always-add-project-ids-to-your-file-ids" id="toc-best-practice-always-add-project-ids-to-your-file-ids" class="nav-link" data-scroll-target="#best-practice-always-add-project-ids-to-your-file-ids"><span class="header-section-number">1.9</span> Best Practice: Always add project IDs to your File IDs</a></li>
  <li><a href="#best-practice-batch-tagging" id="toc-best-practice-batch-tagging" class="nav-link" data-scroll-target="#best-practice-batch-tagging"><span class="header-section-number">1.10</span> Best Practice: Batch Tagging</a></li>
  <li><a href="#best-practice-use-tags-for-archiving" id="toc-best-practice-use-tags-for-archiving" class="nav-link" data-scroll-target="#best-practice-use-tags-for-archiving"><span class="header-section-number">1.11</span> Best Practice: Use tags for archiving</a></li>
  <li><a href="#what-about-dxfuse" id="toc-what-about-dxfuse" class="nav-link" data-scroll-target="#what-about-dxfuse"><span class="header-section-number">1.12</span> What about dxFUSE?</a></li>
  <li><a href="#best-practice-use-dxfuse-file-paths-in-your-scripts" id="toc-best-practice-use-dxfuse-file-paths-in-your-scripts" class="nav-link" data-scroll-target="#best-practice-use-dxfuse-file-paths-in-your-scripts"><span class="header-section-number">1.13</span> Best Practice: Use dxFUSE file paths in your scripts</a>
  <ul class="collapse">
  <li><a href="#dxfuse--limitedwrite" id="toc-dxfuse--limitedwrite" class="nav-link" data-scroll-target="#dxfuse--limitedwrite"><span class="header-section-number">1.13.1</span> dxFUSE: <code>-limitedWrite</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Object Based File Systems</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Project storage on the DNAnexus platform is <em>object-based</em>. This kind of filesystem is probably very different from other file systems you’ve experienced.</p>
<section id="who-this-chapter-is-for" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="who-this-chapter-is-for"><span class="header-section-number">1.1</span> Who This Chapter is For</h2>
<ul>
<li>You are a <em>bioinformatician</em> used to working on path-based file systems and you find object based file systems confusing</li>
<li>You are a <em>data manager</em> or <em>data engineer</em> wanting to adapt your data policies to the DNAnexus platform.</li>
</ul>
</section>
<section id="learning-objectives" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">1.2</span> Learning Objectives</h2>
<p>The goal of this chapter is to show how the DNAnexus filesystem is different from your previous experiences, and to highlight ways to work successfully on the platform given these differences. Specifically you will be able to:</p>
<ol type="1">
<li><strong>Compare</strong> and <strong>contrast</strong> differences between object-based file systems and POSIX filesystems</li>
<li><strong>Explain</strong> the role of metadata and folders in organizing data and outputs</li>
<li><strong>Tag</strong> and <strong>utilize</strong> tags for selecting files and separating output from multiple jobs.</li>
</ol>
</section>
<section id="terminology" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="terminology"><span class="header-section-number">1.3</span> Terminology</h2>
<p>There is a lot of terminology in talking about file systems. Check back here if you’re not sure of the definition of something.</p>
<ul>
<li><strong>POSIX</strong> filesystem - What we think of when we think of Linux filesystems. A set of standards that define how files are created and managed. POSIX filesystems have <em>paths</em> and <em>files</em>.</li>
<li><strong>Data</strong> - The actual file contents. For example, for a CSV file, the actual header and rows correspond to the data.</li>
<li><strong>Metadata</strong> - information that is not part of the data, but is associated with the data. For our CSV file, some examples of metadata are the <em>file permissions</em> (who can access the file), the <em>creator</em>, and the <em>creation date</em>.</li>
<li><strong>Object</strong> - A contiguous set of memory that contains both the <em>data</em> and <em>metadata</em>. Has a unique identifier.</li>
<li><strong>Unique Identifier</strong> - the actual “pointer” for accessing the file. Unique to the file object when it is created. Does not change for the entire lifecycle of an object.</li>
<li><strong>Database Engine</strong> - software that allows for rapid searching and retrieving objects.</li>
</ul>
</section>
<section id="review-posix-filesystems" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="review-posix-filesystems"><span class="header-section-number">1.4</span> Review: POSIX Filesystems</h2>
<p>You may be familiar with <em>POSIX</em> (Portable Operating System Interface) file systems as a way to organize your data in folders. The <em>POSIX</em> standard basically defines the filesystem API so that they will be compatible with other file systems.</p>
<p>In POSIX filesystems, the main way to find/refer to a file is through its <em>path</em>. What does this mean?</p>
<p>For example, if my file is called <code>chr1.vcf.gz</code> and it is located in the directory <code>/Geno_Data</code>, we’d refer to it using the <em>full path</em>:</p>
<pre><code>/Geno_Data/chr1.vcf.gz</code></pre>
<p>Paths are the main way we organize and group files for POSIX filesystems (even devices are mapped to paths, such as <code>/dev/hdd1</code> for an external hard drive). This information is external to a file.</p>
<p>Most importantly, we use directories to organize and group files logically. For example, we might have our R script and the data it analyzes in the same directory.</p>
<p>For a file in a POSIX-based filesystem, <strong>the path needs to be unique.</strong> If they are not, there are transactional rules that are part of the POSIX specification that define when to replace that file with a new one, or to save both versions. For example, we can’t have two files named:</p>
<pre><code>/Geno_Data/chr1.vcf.gz</code></pre>
<p>In the same folder. That violates our ability to find a file in the system.</p>
<p><a href="https://www.computerweekly.com/feature/Posix-vs-object-storage-How-much-longer-for-Posix" class="uri">https://www.computerweekly.com/feature/Posix-vs-object-storage-How-much-longer-for-Posix</a> <a href="https://grimoire.carcano.ch/blog/posix-compliant-filesystems/" class="uri">https://grimoire.carcano.ch/blog/posix-compliant-filesystems/</a></p>
</section>
<section id="object-based-filesystems-are-different" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="object-based-filesystems-are-different"><span class="header-section-number">1.5</span> Object Based Filesystems are different</h2>
<p>In contrast, <em>object-based filesystems</em> do not organize data like a POSIX filesystem. Each file object (such as a csv file, or a BAM file) has a unique identifier that identifies the data object. This unique identifier (like <code>file-aagejFHEJSEI</code>) serves as the main pointer to locate the data object, rather than a path. We’ll see that we can define paths and folders for DNAnexus file objects, but they are stored as part of the metadata for file objects.</p>
<p>File objects also have metadata that can be attached to them. This metadata can be:</p>
<table class="table">
<thead>
<tr class="header">
<th>Metadata Type</th>
<th>Example</th>
<th>Code Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ID</td>
<td><code>project-XXXXX:file-YYYYYY</code></td>
<td><code>dx mv file-YYYY raw_data/</code></td>
</tr>
<tr class="even">
<td>name</td>
<td><code>chr1.tar.gz</code></td>
<td><code>dx find data --name chr1.tar.gz</code></td>
</tr>
<tr class="odd">
<td>Path</td>
<td><code>/raw_data/chr1.tar.gz</code></td>
<td><code>dx find data --path /raw_data/</code></td>
</tr>
<tr class="even">
<td>Creation Date</td>
<td><code>2021-12-01</code></td>
<td><code>dx find data --created-after 2021-12-01</code></td>
</tr>
<tr class="odd">
<td>Tags</td>
<td><code>report</code>, <code>run1</code></td>
<td><code>dx tag file-xxxxxx report</code></td>
</tr>
<tr class="even">
<td>Properties</td>
<td><code>eid = 1153xxx</code></td>
<td><code>dx find data --property eid=1153xxx</code></td>
</tr>
</tbody>
</table>
<p>On the DNAnexus platform, both the <em>filename</em> and its path are considered <strong>metadata</strong>. This <em>metadata</em> is considered as part of the object, along with the <em>data</em> portion of the object.</p>
<p>Importantly, <em>folders are not considered objects on the platform</em> - folders only exist within the metadata for file objects.</p>
<p>The other issue is that <em>the metadata for an object has no requirements to be unique</em>, unlike paths. Which means you can have duplicates with the same file name in the same folder.</p>
<p>I know, this can be very distressing for most people. You can have two objects with the same file name, but they are considered distinct objects because they have unique identifiers.</p>
<p><a href="https://www.ibm.com/cloud/blog/object-vs-file-vs-block-storage" class="uri">https://www.ibm.com/cloud/blog/object-vs-file-vs-block-storage</a></p>
</section>
<section id="comparing-posix-and-object-based-file-systems" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="comparing-posix-and-object-based-file-systems"><span class="header-section-number">1.6</span> Comparing POSIX and Object Based File Systems</h2>
<table class="table">
<thead>
<tr class="header">
<th>Concept</th>
<th>POSIX File System</th>
<th>Object-Based System</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>File ID</td>
<td>Represented by Full Path</td>
<td>Represented by Object ID</td>
</tr>
<tr class="even">
<td>Storage</td>
<td>Data with limited metadata</td>
<td>Metadata+Data</td>
</tr>
<tr class="odd">
<td>Path/Filename</td>
<td>Must be Unique</td>
<td>Can be duplicated</td>
</tr>
<tr class="even">
<td>Metadata</td>
<td>Limited</td>
<td>Rich, can be freely modified after creation</td>
</tr>
</tbody>
</table>
</section>
<section id="tracing-the-journey-of-a-file-object-onto-the-platform" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="tracing-the-journey-of-a-file-object-onto-the-platform"><span class="header-section-number">1.7</span> Tracing the journey of a file object onto the platform</h2>
<p>When a file uploaded, file objects go through three stages before they are available. These stages are:</p>
<ol type="1">
<li><strong>Open</strong> - Files are still being transferred via <code>dx upload</code> or the Upload Agent <code>ua</code>.</li>
<li><strong>Closing</strong> - File objects stay in this state for no longer than 8-10 seconds.</li>
<li><strong>Closed</strong> - Files are now available to be utilized on the platform, either with an app, workflow, or downloaded.</li>
</ol>
<pre><code>% dx describe file-FpQKQpQ0Fgk3gQZz3gPXQj7x
Result 1:
ID                    file-FpQKQpQ0Fgk3gQZz3gPXQj7x
Class                 file
Project               project-GJ496B00FZfxPV5VG36FybvY
Folder                /data
Name                  NA12878.bai
State                 closed
Visibility            visible
Types                 -
Properties            -
Tags                  -
Outgoing links        -
Created               Wed Apr 22 17:59:22 2020
Created by            emiai
 via the job          job-FpQGX780FgkG4bGz86zZk04V
Last modified         Thu Oct 13 15:38:04 2022
Media type            application/octet-stream
archivalState         "live"
Size                  2.09 MB, sponsored by DNAnexus
cloudAccount          "cloudaccount-dnanexus"</code></pre>
</section>
<section id="copying-files-from-one-project-to-another" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="copying-files-from-one-project-to-another"><span class="header-section-number">1.8</span> Copying Files from One Project to Another</h2>
<p>Copying has an important definition on the platform: <em>it means copying a file from one project to another project.</em> It doesn’t refer to duplicating a file within a project.</p>
<p>When we copy a file from one project to another, the process doesn’t make a new physical copy. The reference to the original file is copied. The data is identical and points to the same location on the platform, and the metadata is copied to the new project.</p>
<p>This is quite nice in that you are not doubly charged for storage on the platform.</p>
<p>One important point: once the metadata is copied into the new project, there is no syncing of the metadata between the two projects. User 1 is free to modify the metadata in Project A (the original project) and changes are not made to the metadata in Project B (the derived project).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
What about cloning?
</div>
</div>
<div class="callout-body-container callout-body">
<p>The documentation talks about <a href="https://documentation.dnanexus.com/developer/api/data-containers/cloning#specification">cloning files</a> into a different project - if you clone a file, it makes a new copy of the <em>metadata</em>. It does not create a new physical copy of the data.</p>
<p>Copying files actually uses the <code>dx api file-XXXXX/clone</code> functionality underneath.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Regions on the DNAnexus Platform
</div>
</div>
<div class="callout-body-container callout-body">
<p>All projects live within a region. As DNAnexus is built on both AWS and Azure, they map to regions within these service providers. <a href="https://documentation.dnanexus.com/developer/api/regions#available-regions">Check here</a> for a table of how the DNAnexus region maps to the service providers.</p>
<p>For example, the UKB RAP region (<code>eu-west-2</code>) is unique and only limited to projects within the scope of UK Biobank.</p>
<p><a href="https://documentation.dnanexus.com/developer/api/regions" class="uri">https://documentation.dnanexus.com/developer/api/regions</a></p>
</div>
</div>
<section id="advantages-of-object-based-filesystems" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="advantages-of-object-based-filesystems"><span class="header-section-number">1.8.1</span> Advantages of Object Based Filesystems</h3>
<p>The DNAnexus platform is only one example of an object-based filesystem. Other examples include Amazon S3 (Simple Storage Service), Microsoft Azure Blob Storage, and Google Cloud Storage.</p>
<p>Why does the world run on object based filesystems? There are a lot of advantages.</p>
<ul>
<li><strong>Highly scalable.</strong> This is the main reason given for using an object-based system. Given that unique identifier, the data part of the object can be very large.</li>
<li><strong>Cost Efficient</strong>. Object based storage is designed to be efficient with very large data objects.</li>
<li><strong>Fast Retrieval.</strong> Object-based filesystems let us work with arbitrarily large file sizes, and we can actually stream files to and from workers. File reading is very fast from an object-based filesystem. This is especially helpful when we are working with large genomic files (such as pVCFs).</li>
<li><strong>Improved search speed.</strong> You can attach various database engines to objects in storage and rapidly search through them. An example of such an engine is Snowflake.</li>
<li><strong>File operations are simplified.</strong> Compared to POSIX filesystems, there are only a few <a href="https://www.enterprisestorageforum.com/management/object-storage-vs-posix-storage-something-in-the-middle-please/">object filesystem commands</a>: PUT, GET, DELETE, POST, HEAD.</li>
</ul>
</section>
<section id="disadvantages-of-object-based-filesystems" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="disadvantages-of-object-based-filesystems"><span class="header-section-number">1.8.2</span> Disadvantages of Object Based Filesystems</h3>
<p>Coming from folder-based/POSIX filesystems, it can be a bit of a mind-bender getting used to object-based filesystems. Some of the disadvantages of Object Based Filesystems include:</p>
<ul>
<li><strong>Objects are immutable</strong>. Once an object is created, you are not able to modify it or edit it in place. If you modify a file on a worker, you can’t overwrite the original file object. A new file object must be created. (If you work with JupyterLab and save a notebook, a new file object is created in the place of the old file object. The old file object persists in a folder called <code>.Notebook_archive</code>.)</li>
<li><strong>You have to be careful when generating outputs</strong>. This can be difficult if you have to resume a set of failed jobs in a new run. You can end up with two different objects with the same filename, and it can be some work to disambiguate these objects.</li>
<li><strong>It’s confusing.</strong> You can actually have two files with the same filename in the same folder, because it is part of the changeable metadata. Disambiguating these two files without using file-ids can be difficult. There are rules that govern this.</li>
<li><strong>Metadata is much more important with file management.</strong> Seriously, use tags for everything, including jobs and files. It will make working with multiple files much easier. And if you are on UKB RAP, leverage the file property metadata (<code>eid</code> and <code>field_id</code>) to help you select the files you want to process.</li>
</ul>
<p>In short, getting used to how object-based filesystems requires a bit of an adjustment on our parts. In many cases, the benefits outweigh the drawbacks.</p>
</section>
</section>
<section id="best-practice-always-add-project-ids-to-your-file-ids" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="best-practice-always-add-project-ids-to-your-file-ids"><span class="header-section-number">1.9</span> Best Practice: Always add project IDs to your File IDs</h2>
<p>In <a href="https://laderast.github.io/bash_for_bioinformatics/">Bash for Bioinformatics</a>, we already discovered one way of working with files on the platform: <a href="https://laderast.github.io/bash_for_bioinformatics/05-batch-processing.html#sec-dx-find"><code>dx find data</code></a>. This is our main tool for finding and selecting files with metadata.</p>
<p>When we work with files outside of our current project, we might reference it by a file-id. Using file IDs by themselves are a global operation and we need to be careful when we use this!</p>
<p>Why is this so? There is a search tree when we use a file ID that is not in our project and without a project context. <a href="https://documentation.dnanexus.com/user/projects/path-resolution">The search over metadata</a> is looking for a file object based on just file ID.</p>
<ol type="1">
<li>Look for the file in the current project</li>
<li>Look at all files across all other projects</li>
</ol>
<p>If you want to use the platform effectively, you want to avoid #2 at all costs, especially when working with a lot of files. The metadata server will take much longer to find your files because it needs to scan more projects.</p>
<p>The lesson here is <strong>when using file-ids, it is safer to put the project-id in front of your file id such as below</strong>:</p>
<pre><code>project-XXXXX:file-YYYYYYYYY</code></pre>
</section>
<section id="best-practice-batch-tagging" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="best-practice-batch-tagging"><span class="header-section-number">1.10</span> Best Practice: Batch Tagging</h2>
<p>So, we need to tag files. Remember, we can leverage <code>xargs</code> for tagging multiple files. In this example, we pipe the output of <code>dx find data</code> into <code>xargs</code> to batch tag them.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dx</span> find data <span class="at">--name</span> <span class="st">"*.bam"</span> <span class="at">--brief</span> <span class="kw">|</span> <span class="fu">xargs</span> <span class="at">-I%</span> sh <span class="at">-c</span> <span class="st">"dx tag % 'bam'"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After we do this, we can check whether our operation was successful. We can run:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">dx</span> find data <span class="at">--tag</span> bam <span class="at">--brief</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is our response:</p>
<pre><code>project-GJ496B00FZfxPV5VG36FybvY:file-BZ9YGzj0x05b66kqQv51011q
project-GJ496B00FZfxPV5VG36FybvY:file-BZ9YGpj0x05xKxZ42QPqZkJY
project-GJ496B00FZfxPV5VG36FybvY:file-BQbXVY0093Jk1KVY1J082y7v
project-GJ496B00FZfxPV5VG36FybvY:file-FpQKQk00FgkGV3Vb3jJ8xqGV
</code></pre>
<p>Using the <code>dx find data/xargs/dx tag</code> combination with various input parameters to <code>dx find data</code> such as <code>--name</code>, <code>--created-before</code>, <code>--created-after</code>, <code>--class</code>, will help us to batch tag files and other objects on the platform.</p>
</section>
<section id="best-practice-use-tags-for-archiving" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="best-practice-use-tags-for-archiving"><span class="header-section-number">1.11</span> Best Practice: Use tags for archiving</h2>
<p>Let’s do something concrete and useful in our project: tag files we no longer need for archiving.</p>
<p>Say there are files we want to archive. We can use <code>dx tag</code> or the DNAnexus UI to tag these files with a specific tag, such as <code>to_archive</code>. This can be done by users.</p>
<p>An administrator can then run a monthly job that archives the files with these tags first selecting these files with <code>dx find files --tag to_archive</code> and <a href="https://laderast.github.io/bash_for_bioinformatics/05-batch-processing.html#sec-xargs2">piping those file ids</a> into a <code>dx api &lt;project-id&gt; archive &lt;file-id&gt;</code> command.</p>
</section>
<section id="what-about-dxfuse" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="what-about-dxfuse"><span class="header-section-number">1.12</span> What about dxFUSE?</h2>
<p>(See <a href="https://laderast.github.io/bash_for_bioinformatics/04-doing-work-with-dx-run.html#sec-dxfuse">Bash for Bioinformatics</a> for a introduction to dxFUSE.)</p>
<p>You might ask about the role of <a href="https://github.com/dnanexus/dxfuse">dxFUSE</a> with the Object Based Filesystem.</p>
<p>In short, dxFUSE makes the Object Based Filesystem of DNAnexus act like a POSIX filesystem. Specifically, if there are multiple objects with the same name within a folder, it provides a way to <a href="https://github.com/dnanexus/dxfuse">specify these objects using file paths</a>.</p>
<p>One important thing to remember: dxFUSE is only mounted once when you start the JupyterLab App. You will have to use the <code>dxfuse</code> command to remount it to see any files you’ve added to project storage after opening JupyterLab.</p>
</section>
<section id="best-practice-use-dxfuse-file-paths-in-your-scripts" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="best-practice-use-dxfuse-file-paths-in-your-scripts"><span class="header-section-number">1.13</span> Best Practice: Use dxFUSE file paths in your scripts</h2>
<p>Given the ability to stream data from project storage, you might ask how to use this in your scripts.</p>
<p>You can specify file paths in a project using <code>/mnt/project/</code> in your scripts.</p>
<p>Here’s a python example where we’re loading a file called <code>penguins.csv</code> that is in the <code>/data/</code> folder in our project.</p>
<pre><code>import pandas as pd
pd.read_csv("/mnt/project/data/penguins.csv")</code></pre>
<section id="dxfuse--limitedwrite" class="level3" data-number="1.13.1">
<h3 data-number="1.13.1" class="anchored" data-anchor-id="dxfuse--limitedwrite"><span class="header-section-number">1.13.1</span> dxFUSE: <code>-limitedWrite</code></h3>
<p>For the most part, dxFUSE is read-only from project storage. However, it has a <code>-limitedWrite</code> option that is mostly used from writing from the Hadoop File System (HDFS) on a Spark Cluster into project storage.</p>
<pre><code>dxfuse -limitedWrite</code></pre>
<p>Once you have remounted with <code>-limitedWrite</code>, you’ll be able to specify <code>file:///mnt/project</code> urls in your <code>.write()</code> command. This is especially useful when calculating and saving BGEN Index files.</p>
<p>We don’t recommend using this with files that are outside of HDFS. It is mostly helpful when you are working with Hail and Spark and want to get results out of the Spark Cluster.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./project_management.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Project and File Management</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>